<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Rota</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f5f5f7">

<style>
body{
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
margin:0;background:#f5f5f7;color:#1d1d1f;
-webkit-font-smoothing:antialiased;
overscroll-behavior-x:none;
}

.header{
display:flex;
justify-content:center;
align-items:center;
padding:24px 20px 12px;
}

.month-title{
font-size:28px;
font-weight:600;
letter-spacing:-.5px;
}

#grid{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:10px;
padding:20px;
transition:transform .25s ease,opacity .25s ease;
touch-action:pan-y;
}

.day{
background:white;
border-radius:18px;
min-height:90px;
padding:10px;
position:relative;
cursor:pointer;
transition:all .15s ease;
box-shadow:0 1px 2px rgba(0,0,0,.04);
}

.day:hover{
transform:scale(1.04);
box-shadow:0 6px 18px rgba(0,0,0,.08);
}

.day:active{
transform:scale(.95);
}

.day.other{
opacity:.3;
cursor:default;
}

.day-number{
font-size:14px;
font-weight:500;
}

.today{
border:2px solid #007aff;
}

.jordan-day{background:#eaf3ff;}
.iryna-day{background:#f5eaff;}
.both-day{background:linear-gradient(135deg,#eaf3ff,#f5eaff);}
.holiday-day{background:#ffecec;}
.week-error{border:2px solid #ff3b30;}

#modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.3);
backdrop-filter:blur(20px);
display:none;
align-items:center;
justify-content:center;
}

.modal-content{
background:rgba(255,255,255,.95);
backdrop-filter:blur(30px);
border-radius:24px;
padding:24px;
width:360px;
box-shadow:0 20px 40px rgba(0,0,0,.15);
animation:slideUp .18s ease;
}

@keyframes slideUp{
from{transform:translateY(10px);opacity:0}
to{transform:translateY(0);opacity:1}
}

button{
font-family:inherit;
border-radius:14px;
padding:8px 14px;
border:none;
cursor:pointer;
transition:all .15s ease;
}

button:hover{transform:scale(1.05);}

.primary-btn{background:#007aff;color:white;}
.secondary-btn{background:#e5e5ea;}
.danger-btn{background:#ff3b30;color:white;}

form{margin-top:12px;}
label{font-size:13px;display:block;margin-top:8px;}
input,select{
padding:6px;
border-radius:8px;
border:1px solid #ddd;
font-family:inherit;
}

.actions{
display:flex;
justify-content:space-between;
margin-top:18px;
}
</style>
</head>

<body>

<div class="header">
<div id="monthTitle" class="month-title"></div>
</div>

<div id="grid"></div>

<div id="modal">
<div class="modal-content">
<h3 id="modalDate"></h3>

<div style="margin-top:12px;">
<button onclick="selectPerson('jordan')" class="secondary-btn">Jordan</button>
<button onclick="selectPerson('iryna')" class="secondary-btn">Iryna</button>
<button onclick="selectPerson('holiday')" class="secondary-btn">Holiday</button>
</div>

<form id="jordanForm" style="display:none;">
<label>Start</label>
<input type="time" id="jStart">
<label>End</label>
<input type="time" id="jEnd">
<label>Break (mins)</label>
<input type="number" id="jBreak" value="30">
</form>

<form id="irynaForm" style="display:none;">
<label>Start</label>
<input type="time" id="iStart">
<label>End</label>
<input type="time" id="iEnd">
<label>Break (mins)</label>
<input type="number" id="iBreak" value="30">
</form>

<form id="holidayForm" style="display:none;">
<label>Who</label>
<select id="hWho">
<option value="both">Both</option>
<option value="jordan">Jordan</option>
<option value="iryna">Iryna</option>
</select>
</form>

<div class="actions">
<button onclick="clearDay()" class="danger-btn">Clear</button>
<div>
<button onclick="closeModal()" class="secondary-btn">Cancel</button>
<button onclick="saveDay()" class="primary-btn">Save</button>
</div>
</div>
</div>
</div>

<script>
let current=new Date();
let data={};
let editingKey=null;

function dk(d){return d.toISOString().split('T')[0];}

function load(){
data=JSON.parse(localStorage.getItem('rota-'+current.getFullYear()+'-'+(current.getMonth()+1))||'{}');
render();
}

function save(){
localStorage.setItem('rota-'+current.getFullYear()+'-'+(current.getMonth()+1),JSON.stringify(data));
}

function getMonday(d){
d=new Date(d);
const day=d.getDay();
const diff=day===0?-6:1-day;
d.setDate(d.getDate()+diff);
return new Date(d);
}

function render(){
document.getElementById('monthTitle').textContent=current.toLocaleDateString('en-GB',{month:'long',year:'numeric'});
const grid=document.getElementById('grid');
grid.style.opacity=0;
grid.style.transform='translateY(4px)';
setTimeout(()=>{
grid.innerHTML='';
const y=current.getFullYear(),m=current.getMonth();
let date=getMonday(new Date(y,m,1));
for(let i=0;i<42;i++){
const key=dk(date);
const inMonth=date.getMonth()===m;
const cell=document.createElement('div');
cell.className='day'+(inMonth?'':' other');
if(inMonth){
cell.onclick=()=>openModal(key,new Date(date));
attachLongPress(cell,key);
}
const num=document.createElement('div');
num.className='day-number';
num.textContent=date.getDate();
cell.appendChild(num);
const entry=data[key];
if(entry){
if(entry.type==='holiday')cell.classList.add('holiday-day');
else{
if(entry.jordan&&entry.iryna)cell.classList.add('both-day');
else if(entry.jordan)cell.classList.add('jordan-day');
else if(entry.iryna)cell.classList.add('iryna-day');
}
}
if(key===dk(new Date())&&inMonth)cell.classList.add('today');
grid.appendChild(cell);
date.setDate(date.getDate()+1);
}
grid.style.opacity=1;
grid.style.transform='translateY(0)';
},120);
}

function openModal(key,dateObj){
editingKey=key;
document.getElementById('modalDate').textContent=dateObj.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
document.getElementById('modal').style.display='flex';
}

function selectPerson(p){
['jordan','iryna','holiday'].forEach(x=>{
document.getElementById(x+'Form').style.display='none';
});
document.getElementById(p+'Form').style.display='block';
}

function saveDay(){
if(!editingKey)return;
const entry={};
if(document.getElementById('holidayForm').style.display!=='none'){
entry.type='holiday';
entry.holiday={person:document.getElementById('hWho').value};
}else{
const jS=jStart.value,jE=jEnd.value;
if(jS&&jE)entry.jordan={start:jS,end:jE,breakMins:Number(jBreak.value||30)};
const iS=iStart.value,iE=iEnd.value;
if(iS&&iE)entry.iryna={start:iS,end:iE,breakMins:Number(iBreak.value||30)};
}
if(Object.keys(entry).length>0)data[editingKey]=entry;
else delete data[editingKey];
save();closeModal();render();
}

function clearDay(){
if(!editingKey)return;
if(!confirm('Clear this day?'))return;
delete data[editingKey];
save();closeModal();render();
}

function closeModal(){
document.getElementById('modal').style.display='none';
editingKey=null;
}

document.getElementById('modal').addEventListener('click',e=>{
if(e.target.id==='modal')closeModal();
});

/* SWIPE NAVIGATION */
let startX=0;
const grid=document.getElementById('grid');
grid.addEventListener('touchstart',e=>{
startX=e.touches[0].clientX;
});
grid.addEventListener('touchend',e=>{
let diff=e.changedTouches[0].clientX-startX;
if(Math.abs(diff)>60){
if(diff<0)current.setMonth(current.getMonth()+1);
else current.setMonth(current.getMonth()-1);
load();
}
});

/* LONG PRESS DUPLICATE */
function attachLongPress(el,key){
let timer;
el.addEventListener('touchstart',()=>{
timer=setTimeout(()=>{
const prev=new Date(key);
prev.setDate(prev.getDate()-1);
const prevKey=dk(prev);
if(data[prevKey]){
data[key]=JSON.parse(JSON.stringify(data[prevKey]));
save();render();
}
},600);
});
el.addEventListener('touchend',()=>clearTimeout(timer));
}

/* PWA */
if('serviceWorker' in navigator){
navigator.serviceWorker.register('service-worker.js');
}

load();
</script>

</body>
</html>