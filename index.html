<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Rota</title>

<style>
body{
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
margin:0;background:#f5f5f7;color:#1d1d1f;
-webkit-font-smoothing:antialiased;
}

/* HEADER */
.header{
display:flex;
justify-content:space-between;
align-items:center;
padding:24px 20px 12px;
}

.month-title{
font-size:28px;
font-weight:600;
letter-spacing:-.5px;
}

.nav-btn{
background:#e5e5ea;
border:none;
padding:8px 14px;
border-radius:12px;
font-size:18px;
cursor:pointer;
transition:.15s;
}
.nav-btn:hover{transform:scale(1.1);}

/* GRID */
#grid{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:10px;
padding:20px;
transition:.2s;
}

.day{
background:white;
border-radius:18px;
min-height:90px;
padding:10px;
position:relative;
cursor:pointer;
transition:.15s;
box-shadow:0 1px 2px rgba(0,0,0,.05);
}

.day:hover{transform:scale(1.04);}
.day:active{transform:scale(.95);}
.day.other{opacity:.3;cursor:default;}

.day-number{font-size:14px;font-weight:500;}
.today{border:2px solid #007aff;}

/* COLOURS */
.jordan-day{background:#d6ecff;}
.iryna-day{background:#ffd9ec;}
.holiday-day{background:#fff4b8;}
.spare-day{background:#d9f7d9;}
.both-day{background:linear-gradient(135deg,#d6ecff,#ffd9ec);}

.week-error{border:2px solid red;}

.week-summary{
grid-column:span 7;
font-size:14px;
padding:8px 12px;
border-radius:14px;
background:#f2f2f7;
display:flex;
justify-content:space-between;
}

/* MODAL */
#modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.3);
backdrop-filter:blur(20px);
display:none;
align-items:center;
justify-content:center;
}

.modal-content{
background:white;
border-radius:24px;
padding:24px;
width:360px;
box-shadow:0 20px 40px rgba(0,0,0,.2);
animation:slideUp .18s ease;
}

@keyframes slideUp{
from{transform:translateY(10px);opacity:0}
to{transform:translateY(0);opacity:1}
}

button{
font-family:inherit;
border-radius:14px;
padding:8px 14px;
border:none;
cursor:pointer;
transition:.15s;
}

.primary-btn{background:#007aff;color:white;}
.secondary-btn{background:#e5e5ea;}
.danger-btn{background:#ff3b30;color:white;}

form{margin-top:12px;}
label{font-size:13px;display:block;margin-top:8px;}
input,select{padding:6px;border-radius:8px;border:1px solid #ddd;}

.actions{
display:flex;
justify-content:space-between;
margin-top:18px;
}
</style>
</head>

<body>

<div class="header">
<button class="nav-btn" onclick="prevMonth()">‹</button>
<div id="monthTitle" class="month-title"></div>
<button class="nav-btn" onclick="nextMonth()">›</button>
</div>

<div id="grid"></div>

<div id="modal">
<div class="modal-content">
<h3 id="modalDate"></h3>

<div style="margin-top:12px;">
<button onclick="selectType('jordan')" class="secondary-btn">Jordan</button>
<button onclick="selectType('iryna')" class="secondary-btn">Iryna</button>
<button onclick="selectType('holiday')" class="secondary-btn">Holiday</button>
<button onclick="selectType('spare')" class="secondary-btn">Spare</button>
</div>

<form id="jordanForm" style="display:none;">
<label>Start</label>
<input type="time" id="jStart">
<label>End</label>
<input type="time" id="jEnd">
</form>

<form id="irynaForm" style="display:none;">
<label>Start</label>
<input type="time" id="iStart">
<label>End</label>
<input type="time" id="iEnd">
</form>

<form id="holidayForm" style="display:none;">
<label>Holiday</label>
<select id="hWho">
<option value="both">Both</option>
<option value="jordan">Jordan</option>
<option value="iryna">Iryna</option>
</select>
</form>

<form id="spareForm" style="display:none;">
<label>Spare Shift</label>
</form>

<div class="actions">
<button onclick="clearDay()" class="danger-btn">Clear</button>
<div>
<button onclick="closeModal()" class="secondary-btn">Cancel</button>
<button onclick="saveDay()" class="primary-btn">Save</button>
</div>
</div>
</div>
</div>

<script>
let current=new Date();
let data={};
let editingKey=null;

function dk(d){return d.toISOString().split('T')[0];}

function load(){
data=JSON.parse(localStorage.getItem('rota-'+current.getFullYear()+'-'+(current.getMonth()+1))||'{}');
render();
}

function save(){
localStorage.setItem('rota-'+current.getFullYear()+'-'+(current.getMonth()+1),JSON.stringify(data));
}

function getMonday(d){
d=new Date(d);
const day=d.getDay();
const diff=day===0?-6:1-day;
d.setDate(d.getDate()+diff);
return new Date(d);
}

function render(){
document.getElementById('monthTitle').textContent=current.toLocaleDateString('en-GB',{month:'long',year:'numeric'});
const grid=document.getElementById('grid');
grid.innerHTML='';
const y=current.getFullYear(),m=current.getMonth();
let date=getMonday(new Date(y,m,1));

for(let i=0;i<42;i++){
const key=dk(date);
const inMonth=date.getMonth()===m;
const cell=document.createElement('div');
cell.className='day'+(inMonth?'':' other');

if(inMonth){
cell.onclick=()=>openModal(key,new Date(date));
attachLongPress(cell,key);
}

const num=document.createElement('div');
num.className='day-number';
num.textContent=date.getDate();
cell.appendChild(num);

const entry=data[key];
if(entry){
if(entry.type==='holiday')cell.classList.add('holiday-day');
else if(entry.type==='spare')cell.classList.add('spare-day');
else{
if(entry.jordan&&entry.iryna)cell.classList.add('both-day');
else if(entry.jordan)cell.classList.add('jordan-day');
else if(entry.iryna)cell.classList.add('iryna-day');
}
}

if(key===dk(new Date())&&inMonth)cell.classList.add('today');

grid.appendChild(cell);
date.setDate(date.getDate()+1);
}
}

function openModal(key,dateObj){
editingKey=key;
document.getElementById('modalDate').textContent=dateObj.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
document.getElementById('modal').style.display='flex';

const entry=data[key];
if(entry){
if(entry.jordan){
jStart.value=entry.jordan.start;
jEnd.value=entry.jordan.end;
selectType('jordan');
}
if(entry.iryna){
iStart.value=entry.iryna.start;
iEnd.value=entry.iryna.end;
selectType('iryna');
}
if(entry.type==='holiday')selectType('holiday');
if(entry.type==='spare')selectType('spare');
}
}

function selectType(t){
['jordan','iryna','holiday','spare'].forEach(x=>{
document.getElementById(x+'Form').style.display='none';
});
document.getElementById(t+'Form').style.display='block';
}

function saveDay(){
if(!editingKey)return;
const entry={};

if(holidayForm.style.display!=='none'){
entry.type='holiday';
entry.holiday={person:hWho.value};
}else if(spareForm.style.display!=='none'){
entry.type='spare';
}else{
if(jStart.value&&jEnd.value)entry.jordan={start:jStart.value,end:jEnd.value};
if(iStart.value&&iEnd.value)entry.iryna={start:iStart.value,end:iEnd.value};
}

if(Object.keys(entry).length>0)data[editingKey]=entry;
else delete data[editingKey];

save();closeModal();render();
}

function clearDay(){
if(!editingKey)return;
if(!confirm('Clear this day?'))return;
delete data[editingKey];
save();closeModal();render();
}

function closeModal(){
document.getElementById('modal').style.display='none';
editingKey=null;
}

function prevMonth(){current.setMonth(current.getMonth()-1);load();}
function nextMonth(){current.setMonth(current.getMonth()+1);load();}

/* SWIPE */
let startX=0;
grid.addEventListener('touchstart',e=>{startX=e.touches[0].clientX;});
grid.addEventListener('touchend',e=>{
let diff=e.changedTouches[0].clientX-startX;
if(Math.abs(diff)>60){
if(diff<0)nextMonth();
else prevMonth();
}
});

/* LONG PRESS DUPLICATE */
function attachLongPress(el,key){
let timer;
el.addEventListener('touchstart',()=>{
timer=setTimeout(()=>{
const prev=new Date(key);
prev.setDate(prev.getDate()-1);
const prevKey=dk(prev);
if(data[prevKey]){
data[key]=JSON.parse(JSON.stringify(data[prevKey]));
save();render();
}
},600);
});
el.addEventListener('touchend',()=>clearTimeout(timer));
}

load();
</script>

</body>
</html>
